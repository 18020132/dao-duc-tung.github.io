---
url: ml-skills/machine-learning-systems-design/intro-to-ml-systems-design-part-2
layout: post
---

Today in this post, we will discuss about the workflow when building an ML system, when to use ML and four phased of ML adoption.

## The iterative process

The workflow of building an ML system is more of a cycle than a waterfall. There're six main steps in this cycle described in the below figure. You can use [this link](https://whimsical.com/cs-329s-machine-learning-systems-design-note-E7oPi8C6VUU89j8yPJdgzK@2Ux7TurymQRv98nA51qL) to access to the interative view.

![iterative-process][iterative-process]

**Project scoping**: At the very beginning, we usually need to scope the project by laying out goals and objectives, constraints, and evaluation criteria. Stakeholders should be identified and involved. Resources should be estimated and allocated.

**Data management**: Data management includes data processing, data control, data storage, and data consumer. The amount of data used and generated by an ML system can be large and diverse. A scalable infrastructure is required to process and access the data quickly and reliably.

**ML model development**: This stage is where you perform data wrangle, feature engineering, training/evaluation/test datasets creating, model training, model optimization, and model evaluation.

**Deployment**: After a model is ready to be used, a deployment infrastructure should be ready to make the model accessible to users.

**Monitoring and maintenance**: Once in production, we need to monitor and maintain data quality and model quality to detect their decay as soon as possible to be adaptive to changing environments and changing requirements.

**Business analysis**: Model performance needs to be evaluated against business goals and analyzed to generate business insights. These insights can then be used to eliminate unproductive projects or scope out new projects.

## Project scoping

![planning][planning]

This Project scoping stage is not like the other stages which are self-explained. We need to clearly answer a bunch of questions at the very beginning when starting an ML project.

### Goals

> Goals define general purpose of a project.

For example, goals of a Visual Search Based Recommendation System might be:

- Minimize irrelevant search results
- Maximize revenue of new products by recommending them
- Maximize user's engagement

### Objectives

> Objectives define specific steps on how to realize the goals.

For example, to maximize revenue of new products, objectives might be:

- Rank search results by the newest product and promotions
- Filter out outlook-similar products but not profitable

#### Multiple-objective optimization

Objectives can be multiple. When there're multiple objectives, it might be a good idea to decouple them because:

- Optimizing for one objective when training ML models is easier than optimizing for multiple objectives.
- Easier to tweak the system without retraining models
- Easier for maintenance since different objectives might need different maintenance schedules.

### Constraints

> Project's constraints rule out impossible solutions.

#### Time

- How does the schedule look like?
- What and when do the milestones need to be reached?

#### Performance

- **Baselines**: What are you comparing the system to? E.g. existing solutions, competitors solution, etc.
- **Usefulness threshold**: How fast/good the solution needs to be for it to be useful?. E.g: self-driving cars need human-level performance to be useful; a system that predicts what word a user will type next on their phone doesn't., etc.
- **Tradeoffs**: What's more important - false negatives or false positives? E.g: covid screening must not have false negative (patients with covid shouldn't be classified as no covid). Fingerprint unlocking must not have false positive (unauthorized people shouldn't be given access).
- **Interpretability**: Does the solution need to be interpretable? If yes, to whom?
- **Confidence measurement**: Does the solution need confidence score? If yes:
  - What is the threshold to be usable?
  - What do you want to do with predictions below that threshold? discard it, loop in humans, ask for more info from users?

#### Budget

- Maximum initial budget?
- What needs to be achieved to increase budget?

#### Stakeholders

- Who will be affected by the project?
- Who needs to be informed about the project?

#### Privacy

- Privacy requirements for annotation, storage, 3rd-party solutions, cloud services, regulations, etc.
- Data:
  - Can data be shipped outside organizations for annotation?
  - Can the system be connected to the internet?
  - How long can we keep users' data?

#### Techincal constraints

Any tool or system the the solution must be compatible with? E.g: legacy infrastructure is a huge bottleneck for organizations to adopt ML.

### Evaluation

- How to evaluate system's performance during development and production?
  - If you need ground truth labels, how can they be generated or inferred from users' reactions?
- How to tie model performance to business goals and objectives?

## When to use ML?

![when-to][when-to]

_Machine learning is an approach to **learn complex patterns** from **existing data** and use these patterns to make **predictions** on **unseen data**._

We'll look at each of the bold keyphrases in the definition to understand its implications to the problems ML can solve.

1. **Patterns**: Data must have patterns
2. **Learn**: Possible to form an objective function to guide the learning
3. **Complex**: Patterns are complex
4. **Existing data**: Data is available, or it's possible to collect
5. **Unseen data**: Unseen data shares patterns with training data
6. **Predictions**: It's a predictive problem
7. **It's repetitive**: When taks is repetitive, pattern is repeated multiple times
8. **It's at scale**: A lot of data will be used for training
9. **Patterns are constantly changing**: ML allows you to learn from changing data

Some examples of applications that leverage ML:

- **Authentication**: with your face or fingerprints
- **Machine translation**
- **Writing**: autocorrection, autocompletion, predictive typing
- **Photos**: auto-enhancements and filters
  - E.g. Google Photos, Instagram, Snapchat
- **Personal assistant**: automatically scheduling, booking flight tickets, placing orders, question answering
  - E.g. Siri, Google Assistant, Alexa
- **Home security**: detecting when pets leave house or intrusion when no one is home
- **Elderly care**: at-home health monitoring, fall detection
- **Health care**: skin cancer detection, diabetes diagnosis, drug-drug interaction predictions, drug discovery
- **General amusements**: finding your celebrity doppelganger, converting your face into a cartoon character, changing your voice

Below are some of the problems that have found a wide adoption of ML in enterprises.

- Search engine
- Recommendation systems
- Demand forecasting
- Pricing optimization
- Customer acquisition
- Churn prediction
- Support ticket classification
- Fraud detection
- Brand monitoring

For more details, please check the original post [here](https://docs.google.com/document/d/15vCMf7SbDuxST9Q-rWtx8o7qHJQN2pE5urCDFTYI1zs/edit#heading=h.w8zj2fsf15p1).

### When not to use machine learning

Even though ML can solve a subset of problems very well, it can't solve and/or shouldn't be used for problems that are under any of the following conditions.

- Unethical.
- Simpler solutions do the trick.
- Impossible to get the right data.
- One single prediction error can cause devastating consequences.
- Every single decision the system makes must be explainable.
- Not cost-effective.

However, even if ML can't solve your problem, it might be possible to break your problem into smaller components and ML can solve some of them.

> A technology might not be efficient now, but it might be in the future. If you wait for the technology to prove its worth to the rest of the industry before jumping on, you might be years or decades behind your competitors.

## Four phased of ML adoption

![moon-phases][moon-phases]

Once you decided to adopt ML into your project, your strategy depends on which phase of ML adoption you are in. Below is the four phases of adopting ML, with solutions from each phase can be used as baselines to evaluate the solutions from the next phase.

### 1. Before ML

You should start with non-ML solutions.

_"If you think that machine learning will give you a 100% boost, then a heuristic will get you 50% of the way there." - Martin Zinkevich in Rules of Machine Learning: Best Practices for ML Engineering_

### 2. Simplest ML models

At this stage, you should start with simple algorithms. E.g: Logistic regression XGBoost, K-nearest neighbors, etc.

This stage allows you to quickly build out a framework from data management from development to deployment that you can test and trust.

### 3. Optimize simple models

Optimize simple ML models with different objective functions, hyperparameter search, feature engineering, more data, ensembles, etc.

This stage allows you to answer questions like how quickly your model decays in production and update your infrastructure accordingly.

### 4. Complex systems

After you reached the limit of simple models and your use case demands significant model improvement.

## Case studies

To end this post, the below figure shows some helpful case studies that might help you to see how actual teams deal with different deployment requirements and constraints. You can use [this link](https://whimsical.com/cs-329s-machine-learning-systems-design-note-E7oPi8C6VUU89j8yPJdgzK@2Ux7TurymQceGZry1Fhr) to access to the interative view.

![case-studies][case-studies]

<!-- MARKDOWN LINKS & IMAGES -->

[iterative-process]: /assets/images/ml-skills/machine-learning-systems-design/intro-to-ml-systems-design-part-2/iterative-process.png
[planning]: /assets/images/ml-skills/machine-learning-systems-design/intro-to-ml-systems-design-part-2/planning.jpg
[when-to]: /assets/images/ml-skills/machine-learning-systems-design/intro-to-ml-systems-design-part-2/when-to.jpg
[moon-phases]: /assets/images/ml-skills/machine-learning-systems-design/intro-to-ml-systems-design-part-2/moon-phases.jpg
[case-studies]: /assets/images/ml-skills/machine-learning-systems-design/intro-to-ml-systems-design-part-2/case-studies.png
